window.wwp=function(){function a(a,b,c,d,e,f,g,h,i,j,k){function m(a,b){a.style.width=b+"%"}function n(a){l.currentTime.innerHTML=a}this.playerContainer=a,this.playBtn=b,this.volume=c,this.volumeValue=d,this.volumeControl=e,this.currentTime=f,this.duration=g,this.fullscreenBtn=h,this.progressBar=i,this.watchedBar=j,this.bufferedBar=k;var l=this;this.updateTime=function(a,b,c){var d=a/c*100;m(l.watchedBar,d),n(b)},this.updateBuffered=function(a,b){var c=a/b*100;m(l.bufferedBar,c)}}function b(a,b){function d(a){var b=c.view.volumeControl.clientWidth/2,d=a/c.view.volume.clientWidth*100-b,e=a;c.view.volumeValue.style.width=e+"%",c.view.volumeControl.style.left=d+"px"}function e(){var a=c.model.getDuration(!0);c.view.duration.innerHTML=a,c.view.currentTime.innerHTML="00:00:00"}this.view=a,this.model=b,this.model.load(),this.model.attachObs(a);var c=this;this.model._video.addEventListener("loadedmetadata",function(){e(),d(c.model.getVolume(!0))}),this.view.playBtn.addEventListener("click",function(){c.model.isPaused()?(c.model.play(),c.view.playBtn.classList.add("player__button--pause")):(c.model.pause(),c.view.playBtn.classList.remove("player__button--pause"))}),this.view.progressBar.addEventListener("click",function(a){var b=c.model.getDuration(),d=b/100*((a.pageX-Math.floor(c.view.progressBar.getBoundingClientRect().left))/c.view.progressBar.clientWidth*100);c.model.setCurrentTime(d)}),this.view.volume.addEventListener("click",function(a){var b=a.pageX-Math.floor(c.view.volume.getBoundingClientRect().left);b>100?b=100:b<0&&(b=0),d(b),c.model.setVolume(b/100)}),this.view.fullscreenBtn.addEventListener("click",function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?(document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),c.view.playerContainer.style.width="",c.view.playerContainer.style.height="",c.view.playerContainer.style.position="",c.view.playerContainer.style.left="",c.view.playerContainer.style.top="",c.view.playerContainer.style.zIndex=""):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),c.view.playerContainer.style.width="100%",c.view.playerContainer.style.height="100vh",c.view.playerContainer.style.position="fixed",c.view.playerContainer.style.left="0",c.view.playerContainer.style.top="0",c.view.playerContainer.style.zIndex="9999")})}function c(a){function d(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=a-3600*b-60*c;return c<10&&(c="0"+c),d<10&&(d="0"+d),b?(b<10&&(b="0"+b),b+":"+c+":"+d):c+":"+d}this._video=a;var b=[],c=this;this.load=function(a){a&&console.log(a),c._video.load()},this.play=function(){c._video.play()},this.pause=function(){c._video.pause()},this.stop=function(){c._video.stop()},this.isPaused=function(){return!!c._video.paused},this.setCurrentTime=function(a){c._video.currentTime=a},this.getDuration=function(a){if(a){var b=Math.floor(c._video.duration);return d(b)}return c._video.duration},this.getCurrentTime=function(){return c._video.currentTime},this.setVolume=function(a){c._video.volume=a},this.getVolume=function(a){return a?100*c._video.volume:c._video.volume},this.attachObs=function(a){b.push(a)},this._video.addEventListener("timeupdate",function(){b.forEach(function(b){b.updateTime(c._video.currentTime,d(Math.floor(a.currentTime)),a.duration)})}),this._video.addEventListener("progress",function(){b.forEach(function(a){4===c._video.readyState&&a.updateBuffered(c._video.buffered.end(c._video.buffered.length-1),c._video.duration)})})}function d(a,b,c,d){function f(a){return a.replace(/<(?:.|\n)*?>/gm,"").replace(/(\'?\w+(?:(?:\'|\-)?\w+)*)/g,function(a){return'<span class="'+e._subtitleWordClassName+'">'+a+"</span>"})}this.prevSubBtn=b,this.nextSubBtn=c,this.playBtn=d,this._subtitlesContainer=a,this._subtitleWordClassName="player__subtitle-word";var e=this;this.update=function(a){a?(this._subtitlesContainer.innerHTML=f(a),this._subtitlesContainer.style.display="inline-block"):(this._subtitlesContainer.style.display="none",this._subtitlesContainer.innerHTML="")}}function e(a,b,c,d){this.view=a,this.model=b,this.pModel=c,this.wordFunction=d,this.model.attachObs(this.view),this.pModel.attachObs(this);var e=this;this.updateTime=function(a,b){this.model.updateSubtitles(a)},this.updateBuffered=function(a){},this.view.prevSubBtn.addEventListener("click",function(){var a;(a=e.model.getPrevSubtitleTime())&&e.pModel.setCurrentTime(a)}),this.view.nextSubBtn.addEventListener("click",function(){var a;(a=e.model.getNextSubtitleTime())&&e.pModel.setCurrentTime(a)}),this.view._subtitlesContainer.addEventListener("click",function(a){var b=a.target;b.classList.contains(e.view._subtitleWordClassName)&&e.wordFunction(b.innerHTML)}),this.view._subtitlesContainer.addEventListener("mousemove",function(){e.pModel.isPaused()||(e.view.playBtn.classList.remove("player__button--pause"),e.pModel.pause())}),this.view._subtitlesContainer.addEventListener("mouseleave",function(){e.pModel.isPaused()&&(e.view.playBtn.classList.add("player__button--pause"),e.pModel.play())})}function f(a){function i(a){~a?(j(a+1),k(a-1)):(j(b+1),k(b))}function j(b){c=b<a.length?b:0}function k(b){d=b>=0?b:a.length-1}var a=a,b=-1,c=0,d=a.length-1,e=[],f=function(){e.forEach(function(c){~b?c.update(a[b].text):c.update("")})},g=function(a){return b!==a&&(i(a),b=a,!0)},h=function(b,c,d){if(d<a[0].end)return void(g(0)&&f());if(d>a[a.length-1].end)return void(g(-1)&&f());var e=Math.floor((b+c)/2);return d>=a[e].start&&d<a[e].end?void(g(e)&&f()):d>a[e].end&&d<a[e+1].start?void(g(-1)&&f()):d>=a[e].end?h(e+1,c,d):h(b,e-1,d)};this.getNextSubtitleTime=function(){var b=a[c].start/1e3;return g(c),f(),b},this.getPrevSubtitleTime=function(){var b=a[d].start/1e3;return g(d),f(),b},this.updateSubtitles=function(b){var b=1e3*b;b>a[0].start&&h(0,a.length,b)},this.attachObs=function(a){e.push(a)}}var g=function(g){if(!g)return!1;var h=new a(g.playerContainer,g.ui.playBtn,g.ui.volume,g.ui.volumeValue,g.ui.volumeControl,g.ui.currentTime,g.ui.duration,g.ui.fullscreenBtn,g.ui.progressBar,g.ui.watchedBar,g.ui.bufferedBar),i=new c(g.video),l=(new b(h,i),new d(g.ui.subtitles,g.ui.prevSub,g.ui.nextSub,g.ui.playBtn)),m=new f(g.subtitles);new e(l,m,i,g.wordFunction)};return g}();